---
import { getCategories, getPosts } from "../../../utils/post";
import { MAX_POSTS } from "../../../utils/const";

import Main from "../../../layouts/Main.astro";
import Card from "../../../components/Card.astro";

export async function getStaticPaths({ paginate }) {
  const categories = await getCategories();
  const allPosts = await getPosts();

  return categories.flatMap((category) => {
    const filteredPosts = allPosts.filter(
      (post) => post.data.category === category
    );

    return paginate(filteredPosts, {
      params: {
        category,
      },
      pageSize: MAX_POSTS,
    });
  });
}
const params = Astro.params;
const { page } = Astro.props;

const posts = page.data;
---

<Main title="Cassie's Blog">
  <div class="grid grid-cols-3 gap-8">
    {
      posts.map(({ data: { title, poster, subtitle } }) => {
        return (
          <Card
            title={title}
            link="hello"
            poster={poster}
            subtitle={subtitle}
          />
        );
      })
    }
  </div>
</Main>
